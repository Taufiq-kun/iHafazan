import java.util.Scanner;

import java.io.*;
//import java.io.PrintWriter;
import java.io.File;
import java.io.FileWriter;
import java.io.IOException;
import java.io.BufferedWriter;
//import java.io.BufferedReader;
//import java.util.Formatter;
import java.util.ArrayList;
import java.util.List;

public class ProgressTracking {
    

    
//----------------------------------------------------------------------------------------------------------------------------------
    public static void main(String[] args) throws IOException {
        Scanner scanner = new Scanner(System.in);

        System.out.print("Enter the file name to scan and update (e.g., student_data.txt): ");
        String fileName = scanner.nextLine();

        File file = new File(fileName);

        if (!file.exists() || !file.isFile()) {
            System.out.println("Error: The file " + fileName + " does not exist.");
            return;
        }

        displayFileContent(file);

        System.out.print("Do you want to update a student's feedback? (yes/no): ");
        String updateChoice = scanner.nextLine();

        if (updateChoice.equalsIgnoreCase("yes")) {
            System.out.print("Enter the student's name to update: ");
            String targetName = scanner.nextLine();

            System.out.print("Enter the new feedback: ");
            String newFeedback = scanner.nextLine();

            updateStudentFeedback(file, targetName, newFeedback);
        } else {
            System.out.println("No update performed. Program ended.");
        }
    }

    private static void displayFileContent(File file) throws FileNotFoundException {
        try (Scanner fileScanner = new Scanner(file)) {
            while (fileScanner.hasNextLine()) {
                String line = fileScanner.nextLine();
                String[] splitted = line.split(",");

                if (splitted.length >= 6) {
                    String name = splitted[0];
                    int surah_num = Integer.parseInt(splitted[1]);
                    int start = Integer.parseInt(splitted[2]);
                    int end = Integer.parseInt(splitted[3]);
                    String tarikh = splitted[4];
                    String feedback = splitted[5];

                    System.out.println("Student Name: " + name);
                    System.out.println("  Surah Number: " + surah_num);
                    System.out.println("  Start: " + start);
                    System.out.println("  End: " + end);
                    System.out.println("  Date: " + tarikh);
                    System.out.println("  Feedback: " + feedback);
                    System.out.println("----------------------------------------");
                } else {
                    System.out.println(line);
                }
            }
        }
    }

    private static void updateStudentFeedback(File file, String targetName, String newFeedback) throws IOException {
        List<String> fileContent = new ArrayList<>();
        boolean isUpdated = false;

        try (Scanner fileScanner = new Scanner(file)) {
            while (fileScanner.hasNextLine()) {
                String line = fileScanner.nextLine();
                String[] splitted = line.split(",");

                if (splitted.length >= 6 && splitted[0].equalsIgnoreCase(targetName)) {
                    splitted[5] = newFeedback;
                    line = String.join(",", splitted);
                    isUpdated = true;
                    System.out.println("Feedback updated for " + targetName);
                }
                fileContent.add(line);
            }
        }

        try (BufferedWriter writer = new BufferedWriter(new FileWriter(file))) {
            for (String updatedLine : fileContent) {
                writer.write(updatedLine);
                writer.newLine();
            }
        }

        if (!isUpdated) {
            System.out.println("Student with name '" + targetName + "' not found.");
        }
    }
}
